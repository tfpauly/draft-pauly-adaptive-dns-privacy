<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Adaptive DNS: Improving Privacy of Name Resolution</title>
<meta content="Eric Kinnear" name="author">
<meta content="Tommy Pauly" name="author">
<meta content="Christopher A. Wood" name="author">
<meta content="Patrick McManus" name="author">
<meta content="
       This document defines an architecture that allows clients to dynamically
discover designated resolvers that offer encrypted DNS services, and use them
in an adaptive way that improves privacy while co-existing with locally
provisioned resolvers. These resolvers can be used directly when
looking up names for which they are designated. These resolvers also provide the ability
to proxy encrypted queries, thus hiding the identity of the client requesting resolution. 
    " name="description">
<meta content="xml2rfc 3.12.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-pauly-adaptive-dns-privacy-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.12.0
    Python 3.9.7
    appdirs 1.4.4
    ConfigArgParse 1.3
    google-i18n-address 2.5.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.5
    pycountry 20.7.3
    pyflakes 2.3.1
    PyYAML 5.4.1
    requests 2.26.0
    setuptools 52.0.0
    six 1.16.0
-->
<link href="draft-pauly-adaptive-dns-privacy.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@import url('https://martinthomson.github.io/i-d-template/fonts.css');

html {
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --small-font-size: 14.5px;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
#title {
  padding: 1em 0 0.2em;
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1, h2, h3 {
  font-size: 22px;
  line-height: 26px;
}
h4, h5, h6 {
  font-size: 18px;
  line-height: 22px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p, #abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 18px;
  line-height: 24px;
}
p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
dd.break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href].selfRef {
  color: var(--text-color);
}
a[href] {
  color: var(--link-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px 'Oxygen Mono', monospace;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  pre {
    display: inline-block;
    overflow-x: auto;
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  pre + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
  table {
    display: inline-block;
    overflow-x: auto;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
tr:nth-child(2n) > td {
  background-color: var(--background-color);
}
tr:nth-child(2n+1) > td {
  background-color: var(--highlight-color);
}
thead+tbody > tr:nth-child(2n) > td {
  background-color: var(--highlight-color);
}
thead+tbody > tr:nth-child(2n+1) > td {
  background-color: var(--background-color);
}
table caption {
  margin: 0;
  padding: 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  visibility: hidden;
  user-select: none;
}
a.pilcrow[href] { color: #ddd; }
a.pilcrow[href]:hover { text-decoration: none; }
@media screen {
  :hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 8em;
}
#identifiers dt {
  width: var(--identifier-width);
  margin: 0;
  clear: left;
  float: left;
  text-align: right;
}
#identifiers dd {
  margin: 0 0 0 calc(1em + var(--identifier-width));
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 500px) {
  .index ul {
    column-count: 2;
    column-gap: 20px;
  }
  .index ul ul {
    column-count: 1;
    column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul p, #toc ul li {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table .text-left, table .text-left {
  text-align: left;
}
table .text-center, table .text-center {
  text-align: center;
}
table .text-right, table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
</head>
<body>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">ADNS Privacy</td>
<td class="right">January 2022</td>
</tr></thead>
<tfoot><tr>
<td class="left">Kinnear, et al.</td>
<td class="center">Expires 4 August 2022</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-pauly-adaptive-dns-privacy-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2022-01-31" class="published">31 January 2022</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2022-08-04">4 August 2022</time></dd>
<dt class="label-authors">Authors:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">E. Kinnear</div>
<div class="org">Apple Inc.</div>
</div>
<div class="author">
      <div class="author-name">T. Pauly</div>
<div class="org">Apple Inc.</div>
</div>
<div class="author">
      <div class="author-name">C.A. Wood</div>
<div class="org">Apple Inc.</div>
</div>
<div class="author">
      <div class="author-name">P. McManus</div>
<div class="org">Fastly</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Adaptive DNS: Improving Privacy of Name Resolution</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document defines an architecture that allows clients to dynamically
discover designated resolvers that offer encrypted DNS services, and use them
in an adaptive way that improves privacy while co-existing with locally
provisioned resolvers. These resolvers can be used directly when
looking up names for which they are designated. These resolvers also provide the ability
to proxy encrypted queries, thus hiding the identity of the client requesting resolution.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 4 August 2022.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2022 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.1.2.1">
                <p id="section-toc.1-1.1.2.1.1" class="keepWithNext"><a href="#section-1.1" class="xref">1.1</a>.  <a href="#name-specification-of-requiremen" class="xref">Specification of Requirements</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-terminology" class="xref">Terminology</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-client-behavior" class="xref">Client Behavior</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-discovering-designated-doh-" class="xref">Discovering Designated DoH Servers</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1"><a href="#section-3.1.1" class="xref">3.1.1</a>.  <a href="#name-whitelisting-designated-doh" class="xref">Whitelisting Designated DoH Servers</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.1.2.2">
                    <p id="section-toc.1-1.3.2.1.2.2.1"><a href="#section-3.1.2" class="xref">3.1.2</a>.  <a href="#name-accessing-extended-informat" class="xref">Accessing Extended Information</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-discovering-local-resolvers" class="xref">Discovering Local Resolvers</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-hostname-resolution-algorit" class="xref">Hostname Resolution Algorithm</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="xref">3.4</a>.  <a href="#name-oblivious-resolution" class="xref">Oblivious Resolution</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.3.2.5">
                <p id="section-toc.1-1.3.2.5.1"><a href="#section-3.5" class="xref">3.5</a>.  <a href="#name-handling-network-changes" class="xref">Handling Network Changes</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-server-requirements" class="xref">Server Requirements</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-provide-a-doh-server" class="xref">Provide a DoH Server</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.1">
                    <p id="section-toc.1-1.4.2.1.2.1.1"><a href="#section-4.1.1" class="xref">4.1.1</a>.  <a href="#name-oblivious-doh-proxy" class="xref">Oblivious DoH Proxy</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.2">
                    <p id="section-toc.1-1.4.2.1.2.2.1"><a href="#section-4.1.2" class="xref">4.1.2</a>.  <a href="#name-oblivious-doh-target" class="xref">Oblivious DoH Target</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.1.2.3">
                    <p id="section-toc.1-1.4.2.1.2.3.1"><a href="#section-4.1.3" class="xref">4.1.3</a>.  <a href="#name-keying-material" class="xref">Keying Material</a></p>
</li>
                </ul>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-advertise-the-doh-server" class="xref">Advertise the DoH Server</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-provide-extended-configurat" class="xref">Provide Extended Configuration as a Web PvD</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-server-deployment-considera" class="xref">Server Deployment Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-single-content-provider" class="xref">Single Content Provider</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-multiple-content-providers" class="xref">Multiple Content Providers</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.5.2.3">
                <p id="section-toc.1-1.5.2.3.1"><a href="#section-5.3" class="xref">5.3</a>.  <a href="#name-avoid-narrow-deployments" class="xref">Avoid Narrow Deployments</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-local-resolver-deployment-c" class="xref">Local Resolver Deployment Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-designating-local-doh-serve" class="xref">Designating Local DoH Servers</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2">
                <p id="section-toc.1-1.6.2.2.1"><a href="#section-6.2" class="xref">6.2</a>.  <a href="#name-local-use-cases" class="xref">Local Use Cases</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.1">
                    <p id="section-toc.1-1.6.2.2.2.1.1"><a href="#section-6.2.1" class="xref">6.2.1</a>.  <a href="#name-accessing-local-only-resolv" class="xref">Accessing Local-Only Resolvable Content</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.2">
                    <p id="section-toc.1-1.6.2.2.2.2.1"><a href="#section-6.2.2" class="xref">6.2.2</a>.  <a href="#name-accessing-locally-optimized" class="xref">Accessing Locally Optimized Content</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.3">
                    <p id="section-toc.1-1.6.2.2.2.3.1"><a href="#section-6.2.3" class="xref">6.2.3</a>.  <a href="#name-walled-garden-and-captive-n" class="xref">Walled-Garden and Captive Network Deployments</a></p>
</li>
                  <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.6.2.2.2.4">
                    <p id="section-toc.1-1.6.2.2.2.4.1"><a href="#section-6.2.4" class="xref">6.2.4</a>.  <a href="#name-network-based-filtering" class="xref">Network-Based Filtering</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-performance-considerations" class="xref">Performance Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-privacy-considerations" class="xref">Privacy Considerations</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-10" class="xref">10</a>. <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.1">
                <p id="section-toc.1-1.10.2.1.1"><a href="#section-10.1" class="xref">10.1</a>.  <a href="#name-doh-template-pvd-key" class="xref">DoH Template PvD Key</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.2">
                <p id="section-toc.1-1.10.2.2.1"><a href="#section-10.2" class="xref">10.2</a>.  <a href="#name-dns-filtering-pvd-keys" class="xref">DNS Filtering PvD Keys</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.10.2.3">
                <p id="section-toc.1-1.10.2.3.1"><a href="#section-10.3" class="xref">10.3</a>.  <a href="#name-doh-uri-template-dns-parame" class="xref">DoH URI Template DNS Parameter</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-11" class="xref">11</a>. <a href="#name-acknowledgments" class="xref">Acknowledgments</a></p>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-12" class="xref">12</a>. <a href="#name-references" class="xref">References</a></p>
<ul class="compact toc ulBare ulEmpty">
<li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.1">
                <p id="section-toc.1-1.12.2.1.1"><a href="#section-12.1" class="xref">12.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.12.2.2">
                <p id="section-toc.1-1.12.2.2.1"><a href="#section-12.2" class="xref">12.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="compact toc ulBare ulEmpty" id="section-toc.1-1.13">
            <p id="section-toc.1-1.13.1"><a href="#appendix-A" class="xref"></a><a href="#name-authors-addresses" class="xref">Authors' Addresses</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">When clients need to resolve names into addresses in order to establish networking connections,
they traditionally use by default the DNS resolver that is provisioned
by the local network along with their IP address <span>[<a href="#RFC2132" class="xref">RFC2132</a>]</span> <span>[<a href="#RFC8106" class="xref">RFC8106</a>]</span>. Alternatively, they
can use a resolver indicated by a tunneling service such as a VPN.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">However, privacy-sensitive clients might prefer to use an encrypted DNS service other
than the one locally provisioned in order to prevent interception,
profiling, or modification by entities other than the operator of the
name service for the name being resolved. Protocols that can improve the transport security
of a client when using DNS or creating TLS connections include DNS-over-TLS <span>[<a href="#RFC7858" class="xref">RFC7858</a>]</span>,
DNS-over-HTTPS <span>[<a href="#RFC8484" class="xref">RFC8484</a>]</span>, and encrypted Server Name Indication (ESNI) <span>[<a href="#I-D.ietf-tls-esni" class="xref">I-D.ietf-tls-esni</a>]</span>.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">There are several concerns around a client using such privacy-enhancing mechanisms
for generic system traffic. A remote service that provides encrypted DNS may not provide
correct answers for locally available resources, or private resources (such as domains only
accessible over a private network). Remote services may also be untrusted from a privacy
perspective: while encryption will prevent on-path observers from seeing hostnames,
client systems need to trust the encrypted DNS service to not store or
misuse queries made to it. Further, extensive use of cloud based
recursive resolvers obscures the network location of the client which
may degrade the performance of the returned server due to lack of
proximity at the benefit of improved privacy.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">Client systems are left with choosing between one of the following stances:<a href="#section-1-4" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-1-5">
<li id="section-1-5.1">Send all application DNS queries to a particular encrypted DNS service, which requires establishing
user trust of the service. This can lead to resolution failures for local or private enterprise domains
absent heuristics or other workarounds for detecting managed networks.<a href="#section-1-5.1" class="pilcrow">¶</a>
</li>
        <li id="section-1-5.2">Allow the user or another entity to configure local policy for which domains to send to local,
private, or encrypted resolvers. This provides more granularity at the cost of increasing user burden.<a href="#section-1-5.2" class="pilcrow">¶</a>
</li>
        <li id="section-1-5.3">Only use locally-provisioned resolvers, and opportunistically use encrypted DNS to these resolvers
when possible. (Clients may learn of encrypted transport support by actively probing such
resolvers.) This provides marginal benefit over not using encrypted DNS at all, especially if clients
have no means of authenticating or trusting local resolvers.<a href="#section-1-5.3" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-1-6">This document defines an architecture that allows clients to improve the privacy of their
DNS queries without requiring user intervention, and allowing coexistence with local, private,
and enterprise resolvers.<a href="#section-1-6" class="pilcrow">¶</a></p>
<p id="section-1-7">This architecture is composed of several mechanisms:<a href="#section-1-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-1-8.1">A DNS record that indicates a designated DoH server associated with a name (<a href="#designated-discovery" class="xref">Section 3.1</a>);<a href="#section-1-8.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-8.2">an extension to DoH that allows client IP addresses to be disassociated from queries via proxying (<span>[<a href="#I-D.pauly-dprive-oblivious-doh" class="xref">I-D.pauly-dprive-oblivious-doh</a>]</span>);<a href="#section-1-8.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-8.3">a DoH server that responds to queries directly and supports proxying (<a href="#server" class="xref">Section 4</a>);<a href="#section-1-8.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-1-8.4">and client behavior rules for how to resolve names using a combination of designated DoH resolvers, proxied queries, and local resolvers (<a href="#client" class="xref">Section 3</a>).<a href="#section-1-8.4" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-1-9">Recommendations for local or system policies are out of scope for this document.<a href="#section-1-9" class="pilcrow">¶</a></p>
<div id="specification-of-requirements">
<section id="section-1.1">
        <h3 id="name-specification-of-requiremen">
<a href="#section-1.1" class="section-number selfRef">1.1. </a><a href="#name-specification-of-requiremen" class="section-name selfRef">Specification of Requirements</a>
        </h3>
<p id="section-1.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and
"OPTIONAL" in this document are to be interpreted as described in BCP 14
<span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when,
they appear in all capitals, as shown here.<a href="#section-1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="terminology">
<section id="section-2">
      <h2 id="name-terminology">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-terminology" class="section-name selfRef">Terminology</a>
      </h2>
<p id="section-2-1">This document defines the following terms:<a href="#section-2-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-2-2">
        <dt id="section-2-2.1">
Adaptive DNS:  </dt>
        <dd style="margin-left: 1.5em" id="section-2-2.2">
          <p id="section-2-2.2.1">Adaptive DNS is a technique to provide an encrypted transport for DNS queries that can
be sent directly to a Designated DoH Server, to use Oblivious DoH to hide the client
IP address, or to use Direct Resolvers when required or appropriate.<a href="#section-2-2.2.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.3">
Designated DoH Server:  </dt>
        <dd style="margin-left: 1.5em" id="section-2-2.4">
          <p id="section-2-2.4.1">A DNS resolver that provides connectivity over HTTPS (DoH) that is designated as a
responsible resolver for a given domain or zone.<a href="#section-2-2.4.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.5">
Direct Resolver:  </dt>
        <dd style="margin-left: 1.5em" id="section-2-2.6">
          <p id="section-2-2.6.1">A DNS resolver using any transport that is provisioned directly by a local router or a VPN.<a href="#section-2-2.6.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.7">
Exclusive Direct Resolver:  </dt>
        <dd style="margin-left: 1.5em" id="section-2-2.8">
          <p id="section-2-2.8.1">A Direct Resolver that requires the client to use it exclusively for a given set of domains, such
as private domains managed by a VPN. This status is governed by local system policy.<a href="#section-2-2.8.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.9">
Oblivious DoH:  </dt>
        <dd style="margin-left: 1.5em" id="section-2-2.10">
          <p id="section-2-2.10.1">A technique that uses multiple DoH servers to proxy queries in a way that disassociates
the client's IP address from query content.<a href="#section-2-2.10.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.11">
Oblivious Proxy:  </dt>
        <dd style="margin-left: 1.5em" id="section-2-2.12">
          <p id="section-2-2.12.1">A resolution server that proxies encrypted client DNS queries to another resolution server that
will be able to decrypt the query (the Oblivious Target).<a href="#section-2-2.12.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.13">
Oblivious Target:  </dt>
        <dd style="margin-left: 1.5em" id="section-2-2.14">
          <p id="section-2-2.14.1">A resolution server that receives encrypted client DNS queries via an Oblivious Proxy.<a href="#section-2-2.14.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.15">
Privacy-Sensitive Connections:  </dt>
        <dd style="margin-left: 1.5em" id="section-2-2.16">
          <p id="section-2-2.16.1">Connections made by clients that are explicitly Privacy-Sensitive are treated differently
from connections made for generic system behavior, such as non-user-initiated maintenance
connections. This distinction is only relevant on the client, and does not get communicated
to other network entities. Certain applications, such as browsers, can choose to treat
all connections as privacy-sensitive.<a href="#section-2-2.16.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
<dt id="section-2-2.17">
Web PvD:  </dt>
        <dd style="margin-left: 1.5em" id="section-2-2.18">
          <p id="section-2-2.18.1">A Web Provisioning Domain, or Web PvD, represents the configuration of resolvers, proxies,
and other information that a server deployment makes available to clients. See <a href="#configuration" class="xref">Section 4.3</a>.<a href="#section-2-2.18.1" class="pilcrow">¶</a></p>
</dd>
      <dd class="break"></dd>
</dl>
</section>
</div>
<div id="client">
<section id="section-3">
      <h2 id="name-client-behavior">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-client-behavior" class="section-name selfRef">Client Behavior</a>
      </h2>
<p id="section-3-1">Adaptive DNS allows client systems and applications to improve the privacy
of their DNS queries and connections, both by requiring confidentiality via encryption,
and by limiting the ability to correlate client IP addresses with query contents.
Specifically, the goal for client queries is to achieve the following
properties:<a href="#section-3-1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3-2">
<li id="section-3-2.1">No party other than the client and server can learn or control the
names being queried by the client or the answers being returned by the server.<a href="#section-3-2.1" class="pilcrow">¶</a>
</li>
        <li id="section-3-2.2">Only a designated DNS resolver associated with the deployment that is also
hosting content will be able to read both the client IP address and queried names for
Privacy-Sensitive Connections. For example, a resolver owned and operated by the same
provider that hosts "example.com" would be able to link queries for "example.com" to specific clients
(by their IP address), since the server ultimately has this capability once clients subsequently
establish secure (e.g., TLS) connections to an address to which "example.com" resolves.<a href="#section-3-2.2" class="pilcrow">¶</a>
</li>
        <li id="section-3-2.3">Clients will be able to comply with policies required by VPNs and local networks that
are authoritative for private domains.<a href="#section-3-2.3" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-3-3">An algorithm for determining how to resolve a given name in a manner that satisfies
these properties is described in <a href="#resolution-algorithm" class="xref">Section 3.3</a>. Note that this algorithm
does not guarantee that responses that are not signed with DNSSEC are valid, and clients
that establish connections to unsigned addresses may still expose their local IP addresses
to attackers that control their terminal resolver even if hidden during resolution.<a href="#section-3-3" class="pilcrow">¶</a></p>
<div id="designated-discovery">
<section id="section-3.1">
        <h3 id="name-discovering-designated-doh-">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-discovering-designated-doh-" class="section-name selfRef">Discovering Designated DoH Servers</a>
        </h3>
<p id="section-3.1-1">All direct (non-oblivious) queries for names in privacy-sensitive connections MUST be sent to a
server that both provides encryption and is designated for the domain.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">Clients dynamically build and maintain a set of known Designated DoH Servers. The information
that is associated with each server is:<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1-3.1">The URI Template of the DoH server <span>[<a href="#RFC8484" class="xref">RFC8484</a>]</span><a href="#section-3.1-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-3.2">The public HPKE <span>[<a href="#I-D.irtf-cfrg-hpke" class="xref">I-D.irtf-cfrg-hpke</a>]</span> key of the DoH server used for proxied oblivious queries <span>[<a href="#I-D.pauly-dprive-oblivious-doh" class="xref">I-D.pauly-dprive-oblivious-doh</a>]</span><a href="#section-3.1-3.2" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-3.1-3.3">A list of domains for which the DoH server is designated<a href="#section-3.1-3.3" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-3.1-4">This information can be retrieved from several different sources. The primary source
for discovering Designated DoH Server configurations is from properties stored in a
SVCB (or a SVCB-conformant type like HTTPSSVC) DNS Record <span>[<a href="#I-D.nygren-dnsop-svcb-httpssvc" class="xref">I-D.nygren-dnsop-svcb-httpssvc</a>]</span>.
This record provides the URI Template and the public Oblivious DoH key of a DoH server
that is designated for a specific domain. A specific domain may have more
than one such record.<a href="#section-3.1-4" class="pilcrow">¶</a></p>
<p id="section-3.1-5">In order to designate a DoH server for a domain, a SVCB record can
contain the "dohuri" (<a href="#iana" class="xref">Section 10</a>). The value stored in the parameter
is a URI, which is the DoH URI template <span>[<a href="#RFC8484" class="xref">RFC8484</a>]</span>.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<p id="section-3.1-6">The public key of the DoH server is sent as the "odohkey" <span>[<a href="#I-D.pauly-dprive-oblivious-doh" class="xref">I-D.pauly-dprive-oblivious-doh</a>]</span>.<a href="#section-3.1-6" class="pilcrow">¶</a></p>
<p id="section-3.1-7">The following example shows a record containing a DoH URI, as returned by a query for
the HTTPSSVC variant of the SVCB record type on "example.com".<a href="#section-3.1-7" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1-8">
<pre>
   example.com.      7200  IN HTTPSSVC 0 svc.example.net.
   svc.example.net.  7200  IN HTTPSSVC 2 svc1.example.net. (
                                       dohuri=https://doh.example.net/dns-query
                                       odohkey="..." )
</pre><a href="#section-3.1-8" class="pilcrow">¶</a>
</div>
<p id="section-3.1-9">Clients MUST ignore any DoH server URI that was not retrieved from a
DNSSEC-signed record that was validated by the client <span>[<a href="#RFC4033" class="xref">RFC4033</a>]</span>.<a href="#section-3.1-9" class="pilcrow">¶</a></p>
<p id="section-3.1-10">Whenever a client resolves a name for which it does not already have a Designated DoH Server,
it SHOULD try to determine the Designated DoH Server by sending a query for the an SVCB
record for the name. If there is no DoH server designated for the name or zone, signaled either
by an NXDOMAIN answer or a SVCB record that does not contain a DoH URI, the client SHOULD
suppress queries for the SVCB record for a given name until the time-to-live of the answer expires.<a href="#section-3.1-10" class="pilcrow">¶</a></p>
<p id="section-3.1-11">In order to bootstrap discovery of Designated DoH Servers, client systems SHOULD
have some saved list of at least two names that they use consistently to perform
SVCB record queries on the Direct Resolvers configured by the local network. Since
these queries are likely not private, they SHOULD NOT be associated with user
action or contain user-identifying content. Rather, the expectation is that all client
systems of the same version and configuration would issue the same bootstrapping
queries when joining a network for the first time when the list of Designated
DoH Servers is empty.<a href="#section-3.1-11" class="pilcrow">¶</a></p>
<div id="whitelisting">
<section id="section-3.1.1">
          <h4 id="name-whitelisting-designated-doh">
<a href="#section-3.1.1" class="section-number selfRef">3.1.1. </a><a href="#name-whitelisting-designated-doh" class="section-name selfRef">Whitelisting Designated DoH Servers</a>
          </h4>
<p id="section-3.1.1-1">Prior to using a Designated DoH Server for direct name queries on privacy-sensitive
connections, clients MUST whitelist the server.<a href="#section-3.1.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1.1-2">The requirements for whitelisting are:<a href="#section-3.1.1-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-3.1.1-3.1">Support for acting as an Oblivious Proxy. Each Designated DoH Server is
expected to support acting as a proxy for Oblivious DoH. A client MUST issue at
least one query that is proxied through the server before sending direct queries
to the server.<a href="#section-3.1.1-3.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-3.1.1-3.2">Support for acting as an Oblivious Target. Each Designated DoH Server is
expected to support acting as a target for Oblivious DoH. A client MUST issue at
least one query that is targeted at the server through a proxy before sending direct queries
to the server.<a href="#section-3.1.1-3.2" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-3.1.1-4">Designated DoH Servers are expected to act both as Oblivious Proxies and as Oblivious Targets
to ensure that clients have sufficient options for preserving privacy using Oblivious DoH.
Oblivious Targets are expected to act as Oblivious Proxies to ensure that no Oblivious DoH server
can act as only a target (thus being able to see patterns in name resolution, which might have
value to a resolver) and require other servers to take on a disproportionate load of proxying.<a href="#section-3.1.1-4" class="pilcrow">¶</a></p>
<p id="section-3.1.1-5">Clients MAY further choose to restrict the whitelist by other local policy. For example,
a client system can have a list of trusted resolver configurations, and it can limit
the whitelist of Designated DoH Servers to configurations that match this list.
Alternatively, a client system can check a server against a list of audited and approved
DoH Servers that have properties that the client approves.<a href="#section-3.1.1-5" class="pilcrow">¶</a></p>
<p id="section-3.1.1-6">Clients SHOULD NOT whitelist authority mappings for effective top-level domains (eTLDs), such
as ".com".<a href="#section-3.1.1-6" class="pilcrow">¶</a></p>
<p id="section-3.1.1-7">If a client detects at any point after whitelisting a DoH server that the server no longer
meets the criteria for whitelisting, such as consistently failing to proxy or receive Oblivious DoH
queries, the client SHOULD remove the DoH server from its whitelist.<a href="#section-3.1.1-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="accessing-extended-information">
<section id="section-3.1.2">
          <h4 id="name-accessing-extended-informat">
<a href="#section-3.1.2" class="section-number selfRef">3.1.2. </a><a href="#name-accessing-extended-informat" class="section-name selfRef">Accessing Extended Information</a>
          </h4>
<p id="section-3.1.2-1">When a Designated DoH Server is discovered, clients SHOULD also check to see
if this server provides an extended configuration in the form of a Web PvD (<a href="#configuration" class="xref">Section 4.3</a>).
To do this, the client performs a GET request to the DoH URI, indicating that it accepts
a media type of "application/pvd+json" <span>[<a href="#I-D.ietf-intarea-provisioning-domains" class="xref">I-D.ietf-intarea-provisioning-domains</a>]</span>. When requesting
the PvD information, the query and fragment components of the requested path are left
empty. Note that this is different from a GET request for the "application/dns-message" type,
in which the query variable "dns" contains an encoded version of a DNS message.<a href="#section-3.1.2-1" class="pilcrow">¶</a></p>
<p id="section-3.1.2-2">In response, the server will return the JSON content for the PvD, if present. The content-type
MUST be "application/pvd+json".<a href="#section-3.1.2-2" class="pilcrow">¶</a></p>
<p id="section-3.1.2-3">The following exchange shows an example of a client retrieving a Web PvD configuration
for a DoH server with the URI Template "https://dnsserver.example.net/dns-query".<a href="#section-3.1.2-3" class="pilcrow">¶</a></p>
<p id="section-3.1.2-4">The client sends:<a href="#section-3.1.2-4" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1.2-5">
<pre>
:method = GET
:scheme = https
:authority = dnsserver.example.net
:path = /dns-query
accept = application/pvd+json
</pre><a href="#section-3.1.2-5" class="pilcrow">¶</a>
</div>
<p id="section-3.1.2-6">And the server replies:<a href="#section-3.1.2-6" class="pilcrow">¶</a></p>
<div class="alignLeft art-text artwork" id="section-3.1.2-7">
<pre>
:status = 200
content-type = application/pvd+json
content-length = 175
cache-control = max-age=86400

&lt;JSON content of the Web PvD&gt;
</pre><a href="#section-3.1.2-7" class="pilcrow">¶</a>
</div>
<p id="section-3.1.2-8">If the server does not support retrieving any extended PvD information, it MUST
reply with HTTP status code 415 (Unsupported Media Type, <span>[<a href="#RFC7231" class="xref">RFC7231</a>]</span>).<a href="#section-3.1.2-8" class="pilcrow">¶</a></p>
<p id="section-3.1.2-9">If the retrieved JSON contains a "dnsZones" array <span>[<a href="#I-D.ietf-intarea-provisioning-domains" class="xref">I-D.ietf-intarea-provisioning-domains</a>]</span>,
the client SHOULD perform an SVCB record lookup of each of the listed zones on the DoH
server and validate that the DoH server is a designated server for the domain; and if it is,
add the domain to the local configuration.<a href="#section-3.1.2-9" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="local-discovery">
<section id="section-3.2">
        <h3 id="name-discovering-local-resolvers">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-discovering-local-resolvers" class="section-name selfRef">Discovering Local Resolvers</a>
        </h3>
<p id="section-3.2-1">If the local network provides configuration with an Explicit Provisioning Domain (PvD), as
defined by <span>[<a href="#I-D.ietf-intarea-provisioning-domains" class="xref">I-D.ietf-intarea-provisioning-domains</a>]</span>, clients can learn about domains
for which the local network's resolver is authoritative.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">If an RA provided by the router on the network defines an Explicit PvD that has additional
information, and this additional information JSON dictionary contains the key "dohTemplate" (<a href="#iana" class="xref">Section 10</a>),
then the client SHOULD add this DoH server to its list of known DoH configurations. The
domains that the DoH server claims authority for are listed in the "dnsZones" key. Clients
MUST use an SVCB record from the locally-provisioned DoH server and validate
the answer with DNSSEC <span>[<a href="#RFC4033" class="xref">RFC4033</a>]</span> before creating a mapping from the domain to the server.
Once this has been validated, clients can use this server for resolution as described in
step 2 of <a href="#resolution-algorithm" class="xref">Section 3.3</a>.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">See <a href="#local-deployment" class="xref">Section 6</a> for local deployment considerations.<a href="#section-3.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="resolution-algorithm">
<section id="section-3.3">
        <h3 id="name-hostname-resolution-algorit">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-hostname-resolution-algorit" class="section-name selfRef">Hostname Resolution Algorithm</a>
        </h3>
<p id="section-3.3-1">When establishing a secure connection to a certain hostname, clients need
to first determine which resolver configuration ought to be used for DNS resolution.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">Several of the steps outlined in this algorithm take into account the success or failure
of name resolution. Failure can be indicated either by a DNS response, such as SERVFAIL
or NXDOMAIN, or by a connection-level failure, such as a TCP reset, TLS handshake failure,
or an HTTP response error status. In effect, any unsuccessful attempt to resolve a name
can cause the client to try another resolver if permitted by the algorithm. This is
particularly useful for cases in which a name may not be resolvable over public DNS
but has a valid answer only on the local network.<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<p id="section-3.3-3">Given a specific hostname, the order of preference for which resolver to use
SHOULD be:<a href="#section-3.3-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.3-4">
<li id="section-3.3-4.1">An Exclusive Direct Resolver, such as a resolver provisioned by a VPN,
with domain rules that include the hostname being resolved. If the resolution
fails, the connection will fail. See <a href="#local-discovery" class="xref">Section 3.2</a> and <a href="#local-deployment" class="xref">Section 6</a>.<a href="#section-3.3-4.1" class="pilcrow">¶</a>
</li>
          <li id="section-3.3-4.2">A Direct Resolver, such as a local router, with domain rules that are known to be
authoritative for the domain containing the hostname. If the resolution fails,
the connection will try the next resolver configuration based on this list.<a href="#section-3.3-4.2" class="pilcrow">¶</a>
</li>
          <li id="section-3.3-4.3">The most specific Designated DoH Server that has been whitelisted (<a href="#whitelisting" class="xref">Section 3.1.1</a>) for the domain
containing the hostname, i.e., the designated DoH server which is associated with the longest
matching suffix of the hostname. For example, given two Designated DoH Servers, one for
"foo.example.com" and another "example.com", clients connecting to "bar.foo.example.com"
should use the former. Note that the matching MUST be performed on entire labels. That is,
if "example.com" has a designated DoH server, it can be used for "foo.example.com", but not
for "badexample.com". If the resolution fails, the connection can either use an Oblivious DoH
resolver (Step 4) or the default resolver (Step 5). Privacy-Sensitive Connections SHOULD NOT
skip Step 4. Other connections MAY skip Step 4, based on system policy.<a href="#section-3.3-4.3" class="pilcrow">¶</a>
</li>
          <li id="section-3.3-4.4">Oblivious DoH queries using multiple DoH Servers (<span>[<a href="#I-D.pauly-dprive-oblivious-doh" class="xref">I-D.pauly-dprive-oblivious-doh</a>]</span>). If this resolution fails,
Privacy-Sensitive Connections will fail. All other connections will use the last resort,
the default Direct Resolvers.<a href="#section-3.3-4.4" class="pilcrow">¶</a>
</li>
          <li id="section-3.3-4.5">The default Direct Resolver, generally the resolver provisioned by the local router,
is used as the last resort for any connection that is not explicitly Privacy-Sensitive <span>[<a href="#RFC2132" class="xref">RFC2132</a>]</span> <span>[<a href="#RFC8106" class="xref">RFC8106</a>]</span>.<a href="#section-3.3-4.5" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-3.3-5">If the system allows the user to specify a preferred encrypted resolver, such as
allowing the user to manually configure a DoH server URI to use by default, the use
of this resolver SHOULD come between steps 2 and 3. This ensures that VPN-managed
and locally-accessible names remain accessible while all other names are resolved
using the user preference.<a href="#section-3.3-5" class="pilcrow">¶</a></p>
<p id="section-3.3-6">Resolution on behalf of system traffic, such as interactions required to detect and access
a Captive Network Portal, require the use of the default Direct Resolver. System traffic
SHOULD have an exception to this algorithm, and only use Steps 2 and 5 (those that use
a resolver provisioned by the local network). Further deployment considerations for
captive networks and walled-garden networks can be found in <a href="#captive" class="xref">Section 6.2.3</a>.<a href="#section-3.3-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="oblivious">
<section id="section-3.4">
        <h3 id="name-oblivious-resolution">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-oblivious-resolution" class="section-name selfRef">Oblivious Resolution</a>
        </h3>
<p id="section-3.4-1">For all privacy-sensitive connection queries for names that do not correspond
to a Designated DoH Server, the client SHOULD use Oblivious DoH to help
conceal its IP address from eavesdroppers and untrusted resolvers.<a href="#section-3.4-1" class="pilcrow">¶</a></p>
<p id="section-3.4-2">Disassociation of client IPs from query content is achieved by using Oblivious DoH <span>[<a href="#I-D.pauly-dprive-oblivious-doh" class="xref">I-D.pauly-dprive-oblivious-doh</a>]</span>.
This extension to DoH allows a client to encrypt a query with a target DoH server's public
key, and proxy the query through another server. The query is packaged with a unique
client-defined symmetric key that is used to sign the DNS answer, which is sent
back to the client via the proxy.<a href="#section-3.4-2" class="pilcrow">¶</a></p>
<p id="section-3.4-3">All DoH Servers that are used as Designated DoH Servers by the client
MUST support being both an Oblivious Proxy and an Oblivious Target,
as described in the server requirements (<a href="#server" class="xref">Section 4</a>).<a href="#section-3.4-3" class="pilcrow">¶</a></p>
<p id="section-3.4-4">Since each Designated DoH Server can act as one of two roles in an
proxied exchange, there are (N) * (N - 1) / 2 possible pairs of servers, where
N is the number of whitelisted servers. While clients SHOULD use a variety of
server pairs in rotation to decrease the ability for any given server to track
client queries, it is not expected that all possible combinations will be used.
Some combinations will be able to handle more load than others, and some will have
better latency properties than others. To optimize performance, clients SHOULD
maintain statistics to track the performance characteristics and success rates of
particular pairs.<a href="#section-3.4-4" class="pilcrow">¶</a></p>
<p id="section-3.4-5">Clients that are performing Oblivious DoH resolution SHOULD fall back to another
pair of servers if a first query times out, with a locally-determined limit for the
number of fallback attempts that will be performed.<a href="#section-3.4-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="handling-network-changes">
<section id="section-3.5">
        <h3 id="name-handling-network-changes">
<a href="#section-3.5" class="section-number selfRef">3.5. </a><a href="#name-handling-network-changes" class="section-name selfRef">Handling Network Changes</a>
        </h3>
<p id="section-3.5-1">Whenever a client joins a new network, it SHOULD wait to receive local configuration
for resolvers before using any Designated DoH servers. The local network might
be authoritative for some names, or might require filtering.<a href="#section-3.5-1" class="pilcrow">¶</a></p>
<p id="section-3.5-2">Once the local configuration of the new network has been received, the client
MAY use Designated DoH configuration that it discovered when associated
with another network. These configurations can still be considered valid
since they came from DNSSEC-signed records. However, it is possible that
different resolver IP addresses would be returned when looking up the designated
server on the new network, which can provide a more optimal route through the
Internet, so clients SHOULD perform new queries to refresh their mappings
by making queries on connection on this new interface.<a href="#section-3.5-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="server">
<section id="section-4">
      <h2 id="name-server-requirements">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-server-requirements" class="section-name selfRef">Server Requirements</a>
      </h2>
<p id="section-4-1">Any server deployment that provides a set of services within one or more domains,
such as a CDN, can run a server node that allows clients to run Adaptive DNS.
A new server node can be added at any time, and can be used once it is
advertised to clients and can be validated and whitelisted. The system overall
is intended to scale and provide improved performance as more nodes become
available.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">The basic requirements to participate as a server node in this architecture are
described below.<a href="#section-4-2" class="pilcrow">¶</a></p>
<div id="provide-a-doh-server">
<section id="section-4.1">
        <h3 id="name-provide-a-doh-server">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-provide-a-doh-server" class="section-name selfRef">Provide a DoH Server</a>
        </h3>
<p id="section-4.1-1">Each server node is primarily defined by a DoH server <span>[<a href="#RFC8484" class="xref">RFC8484</a>]</span> that is designated
for a set of domains, and also provides Oblivious DoH functionality. As such, the DoH servers
MUST be able to act as recursive resolvers that accept queries for records and domains beyond
those for which the servers are specifically designated.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<div id="oblivious-doh-proxy">
<section id="section-4.1.1">
          <h4 id="name-oblivious-doh-proxy">
<a href="#section-4.1.1" class="section-number selfRef">4.1.1. </a><a href="#name-oblivious-doh-proxy" class="section-name selfRef">Oblivious DoH Proxy</a>
          </h4>
<p id="section-4.1.1-1">The DoH servers MUST be able to act as Oblivious Proxies. In this function, they will proxy
encrypted queries and answers between clients and Oblivious Target DoH servers.<a href="#section-4.1.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="oblivious-doh-target">
<section id="section-4.1.2">
          <h4 id="name-oblivious-doh-target">
<a href="#section-4.1.2" class="section-number selfRef">4.1.2. </a><a href="#name-oblivious-doh-target" class="section-name selfRef">Oblivious DoH Target</a>
          </h4>
<p id="section-4.1.2-1">The DoH servers MUST be able to act as Oblivious Targets. In this function, they will accept
encrypted proxied queries from clients via Oblivious Proxy DoH servers, and provide encrypted
answers using client keys.<a href="#section-4.1.2-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="keying-material">
<section id="section-4.1.3">
          <h4 id="name-keying-material">
<a href="#section-4.1.3" class="section-number selfRef">4.1.3. </a><a href="#name-keying-material" class="section-name selfRef">Keying Material</a>
          </h4>
<p id="section-4.1.3-1">In order to support acting as an Oblivious Target, a DoH server needs to provide a public
HPKE <span>[<a href="#I-D.irtf-cfrg-hpke" class="xref">I-D.irtf-cfrg-hpke</a>]</span> key that can be used to encrypt client queries. This key is advertised
in the SVCB record <span>[<a href="#I-D.pauly-dprive-oblivious-doh" class="xref">I-D.pauly-dprive-oblivious-doh</a>]</span>.<a href="#section-4.1.3-1" class="pilcrow">¶</a></p>
<p id="section-4.1.3-2">DoH servers also SHOULD provide an ESNI <span>[<a href="#I-D.ietf-tls-esni" class="xref">I-D.ietf-tls-esni</a>]</span> key to encrypt the Server
Name Indication field in TLS handshakes to the DoH server.<a href="#section-4.1.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="advertise-the-doh-server">
<section id="section-4.2">
        <h3 id="name-advertise-the-doh-server">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-advertise-the-doh-server" class="section-name selfRef">Advertise the DoH Server</a>
        </h3>
<p id="section-4.2-1">The primary mechanism for advertising a Designated DoH Server is a SVCB DNS
record (<a href="#designated-discovery" class="xref">Section 3.1</a>). This record MUST contain both the URI Template of the DoH
Server as well as the Oblivious DoH Public Key. It MAY contain the ESNI key <span>[<a href="#I-D.ietf-tls-esni" class="xref">I-D.ietf-tls-esni</a>]</span>.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">Servers MUST ensure that any SVCB records are signed with DNSSEC <span>[<a href="#RFC4033" class="xref">RFC4033</a>]</span>.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="configuration">
<section id="section-4.3">
        <h3 id="name-provide-extended-configurat">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-provide-extended-configurat" class="section-name selfRef">Provide Extended Configuration as a Web PvD</a>
        </h3>
<p id="section-4.3-1">Beyond providing basic DoH server functionality, server nodes SHOULD
provide a mechanism that allows clients to look up properties and
configuration for the server deployment. Amongst other information,
this configuration can optionally contain a list of some popular domains for
which this server is designated. Clients can use this list to optimize lookups
for common names.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">This set of extended configuration information is referred to as a
Web Provisioning Domain, or a Web PvD. Provisioning Domains are
sets of consistent information that clients can use to access networks,
including rules for resolution and proxying. Generally, these PvDs are
provisioned directly, such as by a local router or a VPN.
<span>[<a href="#I-D.ietf-intarea-provisioning-domains" class="xref">I-D.ietf-intarea-provisioning-domains</a>]</span> defines an extensible configuration
dictionary that can be used to add information to local PvD configurations.
Web PvDs share the same JSON configuration format, and share the
registry of keys defined as "Additional Information PvD Keys".<a href="#section-4.3-2" class="pilcrow">¶</a></p>
<p id="section-4.3-3">If present, the PvD JSON configuration MUST be made available to clients that
request the "application/pvd+json" media type in a GET request to the DoH server's
URI <span>[<a href="#I-D.ietf-intarea-provisioning-domains" class="xref">I-D.ietf-intarea-provisioning-domains</a>]</span>. Clients MUST include this media type
as an Accept header in their GET requests, and servers MUST mark this media type
as their Content-Type header in responses. If the PvD JSON format is not supported,
the server MUST reply with HTTP status code 415 <span>[<a href="#RFC7231" class="xref">RFC7231</a>]</span>.<a href="#section-4.3-3" class="pilcrow">¶</a></p>
<p id="section-4.3-4">The "identifier" key in the JSON configuration SHOULD be the hostname of the DoH Server itself.<a href="#section-4.3-4" class="pilcrow">¶</a></p>
<p id="section-4.3-5">For Web PvDs, the "prefixes" key within the JSON configuration SHOULD contain
an empty array.<a href="#section-4.3-5" class="pilcrow">¶</a></p>
<p id="section-4.3-6">The key "dnsZones", which contains an array of domains as strings <span>[<a href="#I-D.ietf-intarea-provisioning-domains" class="xref">I-D.ietf-intarea-provisioning-domains</a>]</span>,
indicates the zones that belong to the PvD. Any zone that is listed in this array for a Web PvD
MUST have a corresponding SVCB record that defines the DoH server as designated
for the zone. Servers SHOULD include in this array any names that are considered
default or well-known for the deployment, but is not required or expected to list
all zones or domains for which it is designated. The trade-off here is that zones
that are listed can be fetched and validated automatically by clients, thus removing
a bootstrapping step in discovering mappings from domains to Designated
DoH Servers.<a href="#section-4.3-6" class="pilcrow">¶</a></p>
<p id="section-4.3-7">Clients that retrieve the Web PvD JSON dictionary SHOULD perform an SVCB record
query for each of the entries in the "dnsZones" array in order to populate the
mappings of domains. These MAY be performed in an oblivious fashion, but
MAY also be queried directly on the DoH server (since the information is not user-specific,
but in response to generic server-driven content). Servers can choose
to preemptively transfer the relevant SVCB records if the PvD information retrieval is done
with an HTTP version that supports PUSH semantics. This allows the server to avoid a
round trip in zone validation even before the client has started requested SVCB records.
Once the client requests an SVCB record for one of the names included in the "dnsZones"
array, the server can also include the SVCB records for the other names in the array in
the Additionals section of the DNS response.<a href="#section-4.3-7" class="pilcrow">¶</a></p>
<p id="section-4.3-8">This document also registers one new key in the Additional Information PvD Keys registry,
to identify the URI Template for the DoH server <a href="#iana" class="xref">Section 10</a>. When included in Web PvDs, this URI
MUST match the template in the SVCB DNS Record.<a href="#section-4.3-8" class="pilcrow">¶</a></p>
<p id="section-4.3-9">Beyond providing resolution configuration, the Web PvD configuration can be extended
to offer information about proxies and other services offered by the server deployment.
Such keys are not defined in this document.<a href="#section-4.3-9" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="server-deployment-considerations">
<section id="section-5">
      <h2 id="name-server-deployment-considera">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-server-deployment-considera" class="section-name selfRef">Server Deployment Considerations</a>
      </h2>
<p id="section-5-1">When servers designate DoH servers for their names, the specific deployment
model can impact the effective privacy and performance characteristics.<a href="#section-5-1" class="pilcrow">¶</a></p>
<div id="single-content-provider">
<section id="section-5.1">
        <h3 id="name-single-content-provider">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-single-content-provider" class="section-name selfRef">Single Content Provider</a>
        </h3>
<p id="section-5.1-1">If a name always resolves to server IP addresses that are hosted by a single
content provider, the name ought to designate a single DoH server. This
DoH server will be most optimal when it is designated by many or all names
that are hosted by the same content provider. This ensures that clients
can increase connection reuse to reduce latency in connection setup.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">A DoH server that corresponds to the content provider that hosts content has an
opportunity to tune the responses provided to a client based on the location
inferred by the client IP address.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="multiple-content-providers">
<section id="section-5.2">
        <h3 id="name-multiple-content-providers">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-multiple-content-providers" class="section-name selfRef">Multiple Content Providers</a>
        </h3>
<p id="section-5.2-1">Some hostnames may resolve to server IP addresses that are hosted by multiple
content providers. In such scenarios, the deployment may want to be able to
control the percentage of traffic that flows to each content provider.<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">In these scenarios, there can either be:<a href="#section-5.2-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-5.2-3.1">multiple designated DoH servers that are advertised via SVCB DNS Records; or,<a href="#section-5.2-3.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-5.2-3.2">a single designated DoH server that can be referenced by one or more SVCB DNS Records,
operated by a party that is aware of both content providers and can manage
splitting the traffic.<a href="#section-5.2-3.2" class="pilcrow">¶</a>
</li>
        </ul>
<p id="section-5.2-4">If a server deployment wants to easily control the split of traffic between different
content providers, it ought to use the latter model of using a single designated DoH server
that can better control which IP addresses are provided to clients. Otherwise, if a
client is aware of multiple DoH servers, it might use a single resolver exclusively,
which may lead to inconsistent behavior between clients that choose different resolvers.<a href="#section-5.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="avoid-narrow-deployments">
<section id="section-5.3">
        <h3 id="name-avoid-narrow-deployments">
<a href="#section-5.3" class="section-number selfRef">5.3. </a><a href="#name-avoid-narrow-deployments" class="section-name selfRef">Avoid Narrow Deployments</a>
        </h3>
<p id="section-5.3-1">Using designated DoH servers can improve the privacy of name resolution whenever
a DoH server is designated by many different names within one or more domains.
This limits the amount of information leaked to an attacker observing traffic between a
client and a DoH server: the attacker only learns that the client might be resolving
one of the many names for which the server is designated (or might be performing
an Oblivious query).<a href="#section-5.3-1" class="pilcrow">¶</a></p>
<p id="section-5.3-2">However, if a deployment designates a given DoH server for only one name, or a
very small set of names, then it becomes easier for an attacker to infer that a specific
name is being accessed by a client. For this reason, deployments are encouraged
to avoid deploying a DoH server that is only designated by a small number of names.
Clients can also choose to only whitelist DoH servers that are associated with
many names.<a href="#section-5.3-2" class="pilcrow">¶</a></p>
<p id="section-5.3-3">Beyond the benefits to privacy, having a larger number of names designate
a given DoH server improves the opportunity for DoH connection reuse, which
can improve the performance of name resolutions.<a href="#section-5.3-3" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="local-deployment">
<section id="section-6">
      <h2 id="name-local-resolver-deployment-c">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-local-resolver-deployment-c" class="section-name selfRef">Local Resolver Deployment Considerations</a>
      </h2>
<p id="section-6-1">A key goal of Adaptive DNS is that clients will be able to use Designated DoH Servers
to improve the privacy of queries, without entirely bypassing local network authority and
policy. For example, if a client is attached to an enterprise Wi-Fi network that provides
access and resolution for private names not generally accessible on the Internet, such
names will only be usable when a local resolver is used.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">In order to achieve this, a local network can advertise itself as authoritative for a domain,
allowing it to be used prior to external servers in the client resolution algorithm <a href="#resolution-algorithm" class="xref">Section 3.3</a>.<a href="#section-6-2" class="pilcrow">¶</a></p>
<div id="designating-local-servers">
<section id="section-6.1">
        <h3 id="name-designating-local-doh-serve">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-designating-local-doh-serve" class="section-name selfRef">Designating Local DoH Servers</a>
        </h3>
<p id="section-6.1-1">If a local network wants to have clients send queries for a set of private domains to its own resolver,
it needs to define an explicit provisioning domain <span>[<a href="#I-D.ietf-intarea-provisioning-domains" class="xref">I-D.ietf-intarea-provisioning-domains</a>]</span>.
The PvD RA option SHOULD set the H-flag to indicate that Additional Information is available.
This Additional Information JSON object SHOULD include both the "dohTemplate" and "dnsZones"
keys to define the local DoH server and the domains over which it claims authority.<a href="#section-6.1-1" class="pilcrow">¶</a></p>
<p id="section-6.1-2">In order to validate that a local resolver is designated for a given zone, the client SHOULD issue
a SVCB record query for the names specified in the PvD information, using the DoH server specified
in the PvD information. If there is no SVCB record for a name that points to the DoH server that can be validated
using DNSSEC, the client SHOULD NOT automatically create a designation from the domain name to DoH server.
See specific use cases in <a href="#local-use-cases" class="xref">Section 6.2</a> for cases in which a local resolver may still be used.<a href="#section-6.1-2" class="pilcrow">¶</a></p>
<p id="section-6.1-3">Although local Designated DoH Servers MAY support proxying Oblivious DoH queries, a client SHOULD
NOT select one of these servers as an Oblivious Proxy. Doing so might reveal the client's location
to the Target based on the address of the proxy, which could contribute to deanonymizing the client.
Clients can make an exception to this behavior if the DoH server designated by the local network is known
to be a non-local service, such as when a local network configures a centralized public resolver to handle
its DNS operations.<a href="#section-6.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="local-use-cases">
<section id="section-6.2">
        <h3 id="name-local-use-cases">
<a href="#section-6.2" class="section-number selfRef">6.2. </a><a href="#name-local-use-cases" class="section-name selfRef">Local Use Cases</a>
        </h3>
<p id="section-6.2-1">The various use cases for selecting locally-provisioned resolvers require different approaches for
deployment and client resolution. The following list is not exhaustive, but provides guidance on how
these scenarios can be achieved using the Adaptive DNS algorithm.<a href="#section-6.2-1" class="pilcrow">¶</a></p>
<div id="accessing-local-only-resolvable-content">
<section id="section-6.2.1">
          <h4 id="name-accessing-local-only-resolv">
<a href="#section-6.2.1" class="section-number selfRef">6.2.1. </a><a href="#name-accessing-local-only-resolv" class="section-name selfRef">Accessing Local-Only Resolvable Content</a>
          </h4>
<p id="section-6.2.1-1">Some names are not resolvable using generic DNS resolvers, but require using a DNS server that can
resolve private names. This is common in enterprise scenarios, in which an enterprise can have
a set of private names that it allows to be resolved when connected to a VPN or an enterprise-managed
Wi-Fi network. In this case, clients that do not use the locally-provisioned resolver will fail to resolve
private names.<a href="#section-6.2.1-1" class="pilcrow">¶</a></p>
<p id="section-6.2.1-2">In these scenarios, the local network SHOULD designate a local DoH server for the domains that are
locally resolvable. For example, an enterprise that owns "private.example.org" would advertise
"private.example.org" in its PvD information along with a DoH URI template. Clients could then
use that locally-configured resolver with names under "private.example.org" according to the rules in <a href="#designating-local-servers" class="xref">Section 6.1</a>.<a href="#section-6.2.1-2" class="pilcrow">¶</a></p>
<p id="section-6.2.1-3">In general, clients SHOULD only create designated DoH server associations when they can validate a SVCB
record using DNSSEC. However, some deployments of private names might not want to sign all
private names within a zone. There are thus a few possible deployment models:<a href="#section-6.2.1-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-6.2.1-4.1">"private.example.org" does have a DNSSEC-signed SVCB record that points to the local DoH server.
The client requests the SVCB record for "private.example.org" using the local DoH server that is
specified in the PvD information, and from that point on uses the local DoH server for names under
"private.example.org".<a href="#section-6.2.1-4.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-6.2.1-4.2">Instead of signing "private.example.org", the deployment provides a DNSSEC-signed SVCB record
for "example.org", thus steering all resolution under "example.org" to the local resolver.<a href="#section-6.2.1-4.2" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-6.2.1-4.3">No DNSSEC-signed SVCB record designates the local server. In this case, clients have a hint that
the local network can serve names under "private.example.org", but do not have a way to validate
the designation. Clients can in this case try to resolve names using external servers (such
as via Oblivious DoH), and then MAY fall back to using locally-provisioned resolvers if the names do not
resolve externally. This approach has the risk of exposing private names to public resolvers,
which can be undesirable for certain enterprise deployments. Alternatively, if the client trusts
the local network based on specific policy configured on the client, it can choose to resolve these names
locally first. Note that this approach risks exposing names to a potentially malicious network that is
masquerading as an authority for private names if the network cannot be validated in some other manner.<a href="#section-6.2.1-4.3" class="pilcrow">¶</a>
</li>
          </ul>
<p id="section-6.2.1-5">Deployments SHOULD use the one of the first two approaches (signing their records) whenever possible;
the case of providing unsigned names is only described as a possibility for handling legacy enterprise
deployments. Clients SHOULD choose to ignore any locally designated names that are not
signed unless there is a specific policy configuration on the client.<a href="#section-6.2.1-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="accessing-locally-optimized-content">
<section id="section-6.2.2">
          <h4 id="name-accessing-locally-optimized">
<a href="#section-6.2.2" class="section-number selfRef">6.2.2. </a><a href="#name-accessing-locally-optimized" class="section-name selfRef">Accessing Locally Optimized Content</a>
          </h4>
<p id="section-6.2.2-1">Other names may be resolvable both publicly and on the local resolver, but have more optimized
servers that are accessible only via the local network. For example, a Wi-Fi provider may provide
access to a cache of video content that provides lower latency than publicly-accessible caches.<a href="#section-6.2.2-1" class="pilcrow">¶</a></p>
<p id="section-6.2.2-2">Names that are hosted locally in this way SHOULD use a designation with a DNSSEC-signed SVCB
record for the name. If a client discovers that a local resolver is designated for a given name, the
client SHOULD prefer using connections to this locally-hosted content rather than names resolved
externally.<a href="#section-6.2.2-2" class="pilcrow">¶</a></p>
<p id="section-6.2.2-3">Note that having a DNSSEC-signed designation to the local resolver provides a clear indication
that the entity that manages a given name has an explicit relationship with the local network provider.<a href="#section-6.2.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="captive">
<section id="section-6.2.3">
          <h4 id="name-walled-garden-and-captive-n">
<a href="#section-6.2.3" class="section-number selfRef">6.2.3. </a><a href="#name-walled-garden-and-captive-n" class="section-name selfRef">Walled-Garden and Captive Network Deployments</a>
          </h4>
<p id="section-6.2.3-1">Some networks do not provide any access to the general Internet, but host local content that
clients can access. For example, a network on an airplane can give access to flight information
and in-flight media, but will not allow access to any external hosts or DNS servers. These
networks are often described as "walled-gardens".<a href="#section-6.2.3-1" class="pilcrow">¶</a></p>
<p id="section-6.2.3-2">Captive networks <span>[<a href="#I-D.ietf-capport-architecture" class="xref">I-D.ietf-capport-architecture</a>]</span> are similar in that they block access to
external hosts, although they can provide generic access after some time.<a href="#section-6.2.3-2" class="pilcrow">¶</a></p>
<p id="section-6.2.3-3">If a walled-garden or captive network defines a PvD with additional information, it can
define zones for names that it hosts, such as "airplane.example.com". It can also provide a
locally-hosted encrypted DNS server.<a href="#section-6.2.3-3" class="pilcrow">¶</a></p>
<p id="section-6.2.3-4">However, if such a network does not support explicitly advertising local names,
clients that try to establish connections to DoH servers will experience connection failures.
In these cases, system traffic that is used for connecting to captive portals SHOULD
use local resolvers. In addition, clients MAY choose to fall back to using direct
resolution without any encryption if they determine that all connectivity is blocked otherwise.
Note that this comes with a risk of a network blocking connections in order to induce this
fallback behavior, so clients might want to inform users about this possible attack where
appropriate, or prefer to not fall back if there is a concern about leaking user data.<a href="#section-6.2.3-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="network-based-filtering">
<section id="section-6.2.4">
          <h4 id="name-network-based-filtering">
<a href="#section-6.2.4" class="section-number selfRef">6.2.4. </a><a href="#name-network-based-filtering" class="section-name selfRef">Network-Based Filtering</a>
          </h4>
<p id="section-6.2.4-1">Some networks currently rely on manipulating DNS name resolution in order to apply
content filtering rules to clients associated with the network. Using encrypted DNS resolvers
that are not participating in this filtering can bypass such enforcement. However, simply
blocking connections for filtering is indistinguishable from a malicious attack from
a client's perspective.<a href="#section-6.2.4-1" class="pilcrow">¶</a></p>
<p id="section-6.2.4-2">In order to indicate the presence of filtering requirements, a network deployment
can add the "requireDNSFiltering" and "dnsFilteredZones" keys to its PvD information.
The "dnsFilteredZones" entry can contain an array of strings, each of which is a domain
name that the network requires clients to resolve using the local resolver. If the array contains
the string ".", it indicates the network requires filtering for all domains. If "requireDNSFiltering"
is present with a boolean value of true, the network is indicating that it expects all client systems
to send the names indicated by "dnsFilteredZones" to the local resolver. If "requireDNSFiltering"
is not present or set to false, then the filtering service is considered to be optional for clients
that want to use it as a service to enforce desired policy.<a href="#section-6.2.4-2" class="pilcrow">¶</a></p>
<p id="section-6.2.4-3">Clients that receive indication of filtering requirements SHOULD NOT use any other
resolver for the filtered domains, but treat the network as claiming authority. However,
since this filtering cannot be authenticated, this behavior SHOULD NOT be done
silently without user consent.<a href="#section-6.2.4-3" class="pilcrow">¶</a></p>
<p id="section-6.2.4-4">Networks that try to interfere with connections to encrypted DNS resolvers without
indicating a requirement for filtering cannot be distinguished from misconfigurations
or network attacks. Clients MAY choose to avoid sending any user-initiated connections
on such networks to prevent malicious interception.<a href="#section-6.2.4-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="performance-considerations">
<section id="section-7">
      <h2 id="name-performance-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-performance-considerations" class="section-name selfRef">Performance Considerations</a>
      </h2>
<p id="section-7-1">One of the challenges of using non-local DNS servers (such as cloud-based DoH servers)
is that recursive queries made by these servers will originate from an IP address that
is not necessarily geographically related to the client. Many DNS servers make assumptions
about the geographic locality of clients to their recursive resolvers to optimize answers.
To avoid this problem, the client's subnet can be forwarded to the authoritative server
by the recursive using the EDNS0 Client Subnet feature. Oblivious DoH discourages this practice
for privacy reasons. However, sharing this subnet, while detrimental to privacy, can result in
better targeted DNS resolutions.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">Adaptive DNS splits DoH queries into two sets: those made to Designated DoH Servers,
and those made to Oblivious DoH servers. Oblivious queries are sensitive for privacy,
and can encounter performance degradation as a result of not using the client subnet.
Queries to designated DoH servers, on the other hand, are sent directly by clients, so
the client IP address is made available to these servers. Since these servers are
designated by the authority for the names, they can use the IP address subnet information
to tune DNS answers.<a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">Based on these properties, clients SHOULD prefer lookups via Designated DoH Servers
over oblivious mechanisms whenever possible. Servers can encourage this by setting large
TTLs for SVCB records and using longer TTLs for responses returned by their Designated DoH
Server endpoints which can be more confident they have accurate addressing information.<a href="#section-7-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-8">
      <h2 id="name-security-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-8-1">In order to avoid interception and modification of the information retrieved by clients
using Adaptive DNS, all exchanges between clients and servers are performed over encrypted
connections, e.g., TLS.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">Malicious adversaries may block client connections to all DoH or Oblivious DoH services as a
Denial-of-Service (DoS) measure. Clients which cannot connect to any proxy may, by local
policy, fall back to unencrypted DNS if this occurs.<a href="#section-8-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="privacy-considerations">
<section id="section-9">
      <h2 id="name-privacy-considerations">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-privacy-considerations" class="section-name selfRef">Privacy Considerations</a>
      </h2>
<p id="section-9-1">Clients must be careful in determining to which DoH servers they send queries
directly without proxying. A malicious DoH server that can direct queries to itself
can track or profile client activity. In order to avoid the possibility of a spoofed SVCB
record designating a malicious DoH server for a name, clients MUST ensure that
such records validate using DNSSEC <span>[<a href="#RFC4033" class="xref">RFC4033</a>]</span>.<a href="#section-9-1" class="pilcrow">¶</a></p>
<p id="section-9-2">Even servers that are officially designated can risk leaking or logging information
about client lookups. Such risk can be mitigated by further restricting the list of
DoH servers that are whitelisted for direct use based on client policy.<a href="#section-9-2" class="pilcrow">¶</a></p>
<p id="section-9-3">Using Oblivious DoH reduces the risk that a single DoH server can track or profile
a client. However, clients should exercise caution when using Oblivious DoH responses
from resolvers that do not carry DNSSEC signatures. An adversarial Oblivious Target resolver
that wishes to learn the IP address of clients requesting resolution for sensitive domains can
redirect clients to unique addresses of its choosing. Clients that use these answers when
establishing TLS connections may then leak their local IP address to chosen server.
Thus, when Oblivious DoH answers are returned without DNSSEC, Privacy-Sensitive Connections
concerned about this attack SHOULD conceal their IP address via a TLS- or HTTP-layer proxy
or some other tunneling mechanism.<a href="#section-9-3" class="pilcrow">¶</a></p>
<p id="section-9-4">An adversary able to see traffic on each path segment of a DoH or Oblivious DoH query (e.g., from client to
proxy, proxy to target, and target to an authoritative DNS server) can link queries to specific
clients with high probability. Failure to observe traffic on any one of these path segments
makes this linkability increasingly difficult. For example, if an adversary can only
observe traffic between a client and proxy and egress traffic from a target, then it may
be difficult identify a specific client's query among the recursive queries generated by the target.<a href="#section-9-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="iana">
<section id="section-10">
      <h2 id="name-iana-considerations">
<a href="#section-10" class="section-number selfRef">10. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<div id="doh-template-pvd-key">
<section id="section-10.1">
        <h3 id="name-doh-template-pvd-key">
<a href="#section-10.1" class="section-number selfRef">10.1. </a><a href="#name-doh-template-pvd-key" class="section-name selfRef">DoH Template PvD Key</a>
        </h3>
<p id="section-10.1-1">This document adds a key to the "Additional Information PvD Keys" registry <span>[<a href="#I-D.ietf-intarea-provisioning-domains" class="xref">I-D.ietf-intarea-provisioning-domains</a>]</span>.<a href="#section-10.1-1" class="pilcrow">¶</a></p>
<table class="center" id="table-1">
          <caption><a href="#table-1" class="selfRef">Table 1</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">JSON key</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
              <th class="text-left" rowspan="1" colspan="1">Type</th>
              <th class="text-left" rowspan="1" colspan="1">Example</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">dohTemplate</td>
              <td class="text-left" rowspan="1" colspan="1">DoH URI Template <span>[<a href="#RFC8484" class="xref">RFC8484</a>]</span>
</td>
              <td class="text-left" rowspan="1" colspan="1">String</td>
              <td class="text-left" rowspan="1" colspan="1">"https://dnsserver.example.net/dns-query{?dns}"</td>
            </tr>
          </tbody>
        </table>
</section>
</div>
<div id="dns-filtering-pvd-keys">
<section id="section-10.2">
        <h3 id="name-dns-filtering-pvd-keys">
<a href="#section-10.2" class="section-number selfRef">10.2. </a><a href="#name-dns-filtering-pvd-keys" class="section-name selfRef">DNS Filtering PvD Keys</a>
        </h3>
<p id="section-10.2-1">This document adds a key to the "Additional Information PvD Keys" registry <span>[<a href="#I-D.ietf-intarea-provisioning-domains" class="xref">I-D.ietf-intarea-provisioning-domains</a>]</span>.<a href="#section-10.2-1" class="pilcrow">¶</a></p>
<table class="center" id="table-2">
          <caption><a href="#table-2" class="selfRef">Table 2</a></caption>
<thead>
            <tr>
              <th class="text-left" rowspan="1" colspan="1">JSON key</th>
              <th class="text-left" rowspan="1" colspan="1">Description</th>
              <th class="text-left" rowspan="1" colspan="1">Type</th>
              <th class="text-left" rowspan="1" colspan="1">Example</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">requireDNSFiltering</td>
              <td class="text-left" rowspan="1" colspan="1">A flag to indicate that the network requires filtering all DNS traffic using the provisioned resolver.</td>
              <td class="text-left" rowspan="1" colspan="1">Boolean</td>
              <td class="text-left" rowspan="1" colspan="1">true</td>
            </tr>
            <tr>
              <td class="text-left" rowspan="1" colspan="1">dnsFilteredZones</td>
              <td class="text-left" rowspan="1" colspan="1">A list of DNS domains as strings that represent domains that can be filtered by the provisioned resolver.</td>
              <td class="text-left" rowspan="1" colspan="1">Array of Strings</td>
              <td class="text-left" rowspan="1" colspan="1">[ "." ]</td>
            </tr>
          </tbody>
        </table>
<p id="section-10.2-3">Any network that sets the "requireDNSFiltering" boolean to false but provides "dnsFilteredZones" advertises the optional
service of filtering on the provisioned network.<a href="#section-10.2-3" class="pilcrow">¶</a></p>
<p id="section-10.2-4">An "." in the "dnsFilteredZones" array represents a wildcard, which can be used to indicate that the network is requesting
to filter all names. Any more specific string represents a domain that requires filtering on the network.<a href="#section-10.2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="doh-uri-template-dns-parameter">
<section id="section-10.3">
        <h3 id="name-doh-uri-template-dns-parame">
<a href="#section-10.3" class="section-number selfRef">10.3. </a><a href="#name-doh-uri-template-dns-parame" class="section-name selfRef">DoH URI Template DNS Parameter</a>
        </h3>
<p id="section-10.3-1">If present, this parameters indicates the URI template of a DoH server that is designated
for use with the name being resolved. This is a string encoded as UTF-8 characters.<a href="#section-10.3-1" class="pilcrow">¶</a></p>
<span class="break"></span><dl class="dlParallel" id="section-10.3-2">
          <dt id="section-10.3-2.1">
Name:  </dt>
          <dd style="margin-left: 1.5em" id="section-10.3-2.2">
            <p id="section-10.3-2.2.1">dohuri<a href="#section-10.3-2.2.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-10.3-2.3">
SvcParamKey:  </dt>
          <dd style="margin-left: 1.5em" id="section-10.3-2.4">
            <p id="section-10.3-2.4.1">TBD<a href="#section-10.3-2.4.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-10.3-2.5">
Meaning:  </dt>
          <dd style="margin-left: 1.5em" id="section-10.3-2.6">
            <p id="section-10.3-2.6.1">URI template for a designated DoH server<a href="#section-10.3-2.6.1" class="pilcrow">¶</a></p>
</dd>
          <dd class="break"></dd>
<dt id="section-10.3-2.7">
Reference:  </dt>
          <dd style="margin-left: 1.5em" id="section-10.3-2.8">
            <p id="section-10.3-2.8.1">This document.<a href="#section-10.3-2.8.1" class="pilcrow">¶</a></p>
</dd>
        <dd class="break"></dd>
</dl>
</section>
</div>
</section>
</div>
<div id="acknowledgments">
<section id="section-11">
      <h2 id="name-acknowledgments">
<a href="#section-11" class="section-number selfRef">11. </a><a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-11-1">Thanks to Erik Nygren, Lorenzo Colitti, Tommy Jensen, Mikael Abrahamsson,
Ben Schwartz, Ask Hansen, Leif Hedstrom, Tim McCoy, Stuart Cheshire, Miguel Vega,
Joey Deng, Ted Lemon, and Elliot Briggs for their feedback and input on this document.<a href="#section-11-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-12">
      <h2 id="name-references">
<a href="#section-12" class="section-number selfRef">12. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-12.1">
        <h3 id="name-normative-references">
<a href="#section-12.1" class="section-number selfRef">12.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-intarea-provisioning-domains">[I-D.ietf-intarea-provisioning-domains]</dt>
        <dd>
<span class="refAuthor">Pfister, P.</span>, <span class="refAuthor">Vyncke, E.</span>, <span class="refAuthor">Pauly, T.</span>, <span class="refAuthor">Schinazi, D.</span>, and <span class="refAuthor">W. Shao</span>, <span class="refTitle">"Discovering Provisioning Domain Names and Data"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-intarea-provisioning-domains-11</span>, <time datetime="2020-01-31" class="refDate">31 January 2020</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-intarea-provisioning-domains-11.txt">https://www.ietf.org/archive/id/draft-ietf-intarea-provisioning-domains-11.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-tls-esni">[I-D.ietf-tls-esni]</dt>
        <dd>
<span class="refAuthor">Rescorla, E.</span>, <span class="refAuthor">Oku, K.</span>, <span class="refAuthor">Sullivan, N.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"TLS Encrypted Client Hello"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-tls-esni-13</span>, <time datetime="2021-08-12" class="refDate">12 August 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-tls-esni-13.txt">https://www.ietf.org/archive/id/draft-ietf-tls-esni-13.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.irtf-cfrg-hpke">[I-D.irtf-cfrg-hpke]</dt>
        <dd>
<span class="refAuthor">Barnes, R. L.</span>, <span class="refAuthor">Bhargavan, K.</span>, <span class="refAuthor">Lipp, B.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Hybrid Public Key Encryption"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-irtf-cfrg-hpke-12</span>, <time datetime="2021-09-02" class="refDate">2 September 2021</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-irtf-cfrg-hpke-12.txt">https://www.ietf.org/archive/id/draft-irtf-cfrg-hpke-12.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.nygren-dnsop-svcb-httpssvc">[I-D.nygren-dnsop-svcb-httpssvc]</dt>
        <dd>
<span class="refAuthor">Schwartz, B.</span>, <span class="refAuthor">Bishop, M.</span>, and <span class="refAuthor">E. Nygren</span>, <span class="refTitle">"Service binding and parameter specification via the DNS (DNS SVCB and HTTPSSVC)"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-nygren-dnsop-svcb-httpssvc-00</span>, <time datetime="2019-09-23" class="refDate">23 September 2019</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-nygren-dnsop-svcb-httpssvc-00.txt">https://www.ietf.org/archive/id/draft-nygren-dnsop-svcb-httpssvc-00.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.pauly-dprive-oblivious-doh">[I-D.pauly-dprive-oblivious-doh]</dt>
        <dd>
<span class="refAuthor">Kinnear, E.</span>, <span class="refAuthor">McManus, P.</span>, <span class="refAuthor">Pauly, T.</span>, <span class="refAuthor">Verma, T.</span>, and <span class="refAuthor">C. A. Wood</span>, <span class="refTitle">"Oblivious DNS Over HTTPS"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-pauly-dprive-oblivious-doh-09</span>, <time datetime="2022-01-05" class="refDate">5 January 2022</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-pauly-dprive-oblivious-doh-09.txt">https://www.ietf.org/archive/id/draft-pauly-dprive-oblivious-doh-09.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC4033">[RFC4033]</dt>
        <dd>
<span class="refAuthor">Arends, R.</span>, <span class="refAuthor">Austein, R.</span>, <span class="refAuthor">Larson, M.</span>, <span class="refAuthor">Massey, D.</span>, and <span class="refAuthor">S. Rose</span>, <span class="refTitle">"DNS Security Introduction and Requirements"</span>, <span class="seriesInfo">RFC 4033</span>, <span class="seriesInfo">DOI 10.17487/RFC4033</span>, <time datetime="2005-03" class="refDate">March 2005</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc4033">https://www.rfc-editor.org/info/rfc4033</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7231">[RFC7231]</dt>
        <dd>
<span class="refAuthor">Fielding, R., Ed.</span> and <span class="refAuthor">J. Reschke, Ed.</span>, <span class="refTitle">"Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content"</span>, <span class="seriesInfo">RFC 7231</span>, <span class="seriesInfo">DOI 10.17487/RFC7231</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7231">https://www.rfc-editor.org/info/rfc7231</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7858">[RFC7858]</dt>
        <dd>
<span class="refAuthor">Hu, Z.</span>, <span class="refAuthor">Zhu, L.</span>, <span class="refAuthor">Heidemann, J.</span>, <span class="refAuthor">Mankin, A.</span>, <span class="refAuthor">Wessels, D.</span>, and <span class="refAuthor">P. Hoffman</span>, <span class="refTitle">"Specification for DNS over Transport Layer Security (TLS)"</span>, <span class="seriesInfo">RFC 7858</span>, <span class="seriesInfo">DOI 10.17487/RFC7858</span>, <time datetime="2016-05" class="refDate">May 2016</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7858">https://www.rfc-editor.org/info/rfc7858</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8484">[RFC8484]</dt>
      <dd>
<span class="refAuthor">Hoffman, P.</span> and <span class="refAuthor">P. McManus</span>, <span class="refTitle">"DNS Queries over HTTPS (DoH)"</span>, <span class="seriesInfo">RFC 8484</span>, <span class="seriesInfo">DOI 10.17487/RFC8484</span>, <time datetime="2018-10" class="refDate">October 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8484">https://www.rfc-editor.org/info/rfc8484</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-12.2">
        <h3 id="name-informative-references">
<a href="#section-12.2" class="section-number selfRef">12.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.ietf-capport-architecture">[I-D.ietf-capport-architecture]</dt>
        <dd>
<span class="refAuthor">Larose, K.</span>, <span class="refAuthor">Dolson, D.</span>, and <span class="refAuthor">H. Liu</span>, <span class="refTitle">"Captive Portal Architecture"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-capport-architecture-10</span>, <time datetime="2020-09-23" class="refDate">23 September 2020</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-capport-architecture-10.txt">https://www.ietf.org/archive/id/draft-ietf-capport-architecture-10.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2132">[RFC2132]</dt>
        <dd>
<span class="refAuthor">Alexander, S.</span> and <span class="refAuthor">R. Droms</span>, <span class="refTitle">"DHCP Options and BOOTP Vendor Extensions"</span>, <span class="seriesInfo">RFC 2132</span>, <span class="seriesInfo">DOI 10.17487/RFC2132</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2132">https://www.rfc-editor.org/info/rfc2132</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8106">[RFC8106]</dt>
        <dd>
<span class="refAuthor">Jeong, J.</span>, <span class="refAuthor">Park, S.</span>, <span class="refAuthor">Beloeil, L.</span>, and <span class="refAuthor">S. Madanapalli</span>, <span class="refTitle">"IPv6 Router Advertisement Options for DNS Configuration"</span>, <span class="seriesInfo">RFC 8106</span>, <span class="seriesInfo">DOI 10.17487/RFC8106</span>, <time datetime="2017-03" class="refDate">March 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8106">https://www.rfc-editor.org/info/rfc8106</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="authors-addresses">
<section id="appendix-A">
      <h2 id="name-authors-addresses">
<a href="#name-authors-addresses" class="section-name selfRef">Authors' Addresses</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Eric Kinnear</span></div>
<div dir="auto" class="left"><span class="org">Apple Inc.</span></div>
<div dir="auto" class="left"><span class="street-address">One Apple Park Way</span></div>
<div dir="auto" class="left">
<span class="locality">Cupertino, California 95014</span>,  </div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:ekinnear@apple.com" class="email">ekinnear@apple.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Tommy Pauly</span></div>
<div dir="auto" class="left"><span class="org">Apple Inc.</span></div>
<div dir="auto" class="left"><span class="street-address">One Apple Park Way</span></div>
<div dir="auto" class="left">
<span class="locality">Cupertino, California 95014</span>,  </div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:tpauly@apple.com" class="email">tpauly@apple.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christopher A. Wood</span></div>
<div dir="auto" class="left"><span class="org">Apple Inc.</span></div>
<div dir="auto" class="left"><span class="street-address">One Apple Park Way</span></div>
<div dir="auto" class="left">
<span class="locality">Cupertino, California 95014</span>,  </div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:cawood@apple.com" class="email">cawood@apple.com</a>
</div>
</address>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Patrick McManus</span></div>
<div dir="auto" class="left"><span class="org">Fastly</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mcmanus@ducksong.com" class="email">mcmanus@ducksong.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
